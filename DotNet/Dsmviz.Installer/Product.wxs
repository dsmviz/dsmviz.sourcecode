<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Product Id="*" Name="Dsmviz" Language="1033" Version="$(var.LongAssyVersion)" Manufacturer="Dsmviz" UpgradeCode="C0C28C50-44C7-40DE-AA35-0F13437D7E19">
    <Package InstallerVersion="200" Compressed="yes" InstallScope="perMachine" />
    
    <Media Id="1" Cabinet="simple.cab" EmbedCab="yes" />

    <MajorUpgrade Schedule="afterInstallInitialize"
                  DowngradeErrorMessage="A later version of the DSM viewer is already installed"
                  AllowSameVersionUpgrades="yes" />
    
    <ComponentGroup Id="DsmViewerComponents" Directory="VIEWER_INSTALL_FOLDER">
      <Component Id="Dsmviz.DsmViewer.View.exe" Guid="9E39FD85-9B8E-4B76-9366-13CF6AC732B3">
        <File Id="Dsmviz.DsmViewer.View.exe" Source="..\build\bin\Dsmviz.DsmViewer.View.exe" KeyPath="yes" Checksum="yes"/>
        <ProgId Id="DsmViewerDsi" Description="DSM viewer">
          <Extension Id="dsi">
            <Verb Id="open" TargetFile="Dsmviz.DsmViewer.View.exe" Argument="&quot;%1&quot;" />
          </Extension>
        </ProgId>
        <ProgId Id="DsmViewerDsm" Description="DSM viewer">
          <Extension Id="dsm">
            <Verb Id="open" TargetFile="Dsmviz.DsmViewer.View.exe" Argument="&quot;%1&quot;" />
          </Extension>
        </ProgId>
      </Component>
      <Component Id="Dsmviz.DsmViewer.ViewModel.dll" Guid="2E011513-1100-4610-A661-EE667AC06151">
        <File Id="Dsmviz.DsmViewer.ViewModel.dll" Source="..\build\bin\Dsmviz.DsmViewer.ViewModel.dll" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="Dsmviz.DsmViewer.Application.dll" Guid="79D6350F-8069-41A7-9A40-F75D928FE985">
        <File Id="Dsmviz.DsmViewer.Application.dll" Source="..\build\bin\Dsmviz.DsmViewer.Application.dll" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="Dsmviz.DsmViewer.Model.dll" Guid="4F1F0718-89B7-4BF1-8AFD-97F6D62D553E">
        <File Id="Dsmviz.DsmViewer.Model.dll" Source="..\build\bin\Dsmviz.DsmViewer.Model.dll" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="Dsmviz.Common.Model.DsmViewer.dll" Guid="3B784A87-08E5-4ED0-8730-1868228CD31F">
        <File Id="Dsmviz.Common.Model.DsmViewer.dll" Source="..\build\bin\Dsmviz.Common.Model.dll" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="Dsmviz.Common.Util.DsmViewer.dll" Guid="93B13A2D-50E4-45A1-8C33-3D73E1CCE750">
        <File Id="Dsmviz.Common.Util.dll" Source="..\build\bin\Dsmviz.Common.Util.dll" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="Dsmviz.Analyzer.Model.DsmViewer.dll" Guid="4A933F4A-E039-4E1B-B8F7-855809B1B411">
        <File Id="Dsmviz.Analyzer.Model.DsmViewer.dll" Source="..\build\bin\Dsmviz.Analyzer.Model.dll" KeyPath="yes" Checksum="yes"/>
      </Component>
    </ComponentGroup>

    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFiles64Folder">
        <Directory Id="MAINFOLDER" Name="Dsmviz">
          <Directory Id="ANALYZERS" Name="Analyzers">
            <Directory  Id="DOTNET_ANALYZER_INSTALL_FOLDER" Name="DotNet" />
            <Directory  Id="JAVA_ANALYZER_INSTALL_FOLDER" Name="Java" />
            <Directory  Id="UML_ANALYZER_INSTALL_FOLDER" Name="UML" />
          </Directory>
          <Directory  Id="COMPARER_INSTALL_FOLDER" Name="Comparer" />
          <Directory  Id="VIEWER_INSTALL_FOLDER" Name="Viewer" />
        </Directory>
      </Directory>
      <Directory Id="ProgramMenuFolder">
        <Directory Id="ApplicationProgramsFolder" Name="Dsm Suite"/>
      </Directory>
    </Directory>

    <DirectoryRef Id="ApplicationProgramsFolder">
      <Component Id="ApplicationShortcut" Guid="633CDBBD-AA1E-4F46-9375-49984FFBC033">
        <Shortcut Id="ApplicationStartMenuShortcut"
                  Name="DSM dependency viewer"
                  Description="Application to software dependencies in a matrix"
                  Target="[#Dsmviz.DsmViewer.View.exe]"
                  WorkingDirectory="VIEWER_INSTALL_FOLDER"/>
        <RemoveFolder Id="CleanUpShortCut" Directory="ApplicationProgramsFolder" On="uninstall"/>
        <RegistryValue Root="HKCU" Key="Software\Microsoft\MyApplicationName" Name="installed" Type="integer" Value="1" KeyPath="yes"/>
      </Component>
    </DirectoryRef>

    <WixVariable Id="WixUILicenseRtf" Value="License.rtf" />
    
    <UI>
      <UIRef Id="WixUI_FeatureTree"/>
      <UIRef Id="WixUI_ErrorProgressText"/>
    </UI>

    <Feature Id="DotNetAnalyzerFeature" Title="DSM Suite .Net Analyzer" Level="1">
      <ComponentRef Id="Dsmviz.Analyzer.DotNet.exe" />
      <ComponentRef Id="Dsmviz.Analyzer.DotNet.Lib.dll" />
      <ComponentRef Id="Dsmviz.Analyzer.Model.DotNet.dll" />
      <ComponentRef Id="Dsmviz.Common.Model.DotNet.dll" />
      <ComponentRef Id="Dsmviz.Common.Util.DotNet.dll" />
      <ComponentRef Id="Mono.Cecil.DotNet.dll" />
      <ComponentRef Id="Mono.Cecil.Mdb.DotNet.dll" />
      <ComponentRef Id="Mono.Cecil.Pdb.DotNet.dll" />
      <ComponentRef Id="Mono.Cecil.Rocks.DotNet.dll" />
    </Feature>

    <Feature Id="JavaAnalyzerFeature" Title="DSM Suite JDeps Analyzer" Level="1">
      <ComponentRef Id="Dsmviz.Analyzer.Jdeps.exe" />
      <ComponentRef Id="Dsmviz.Analyzer.Model.Jdeps.dll" />
      <ComponentRef Id="Dsmviz.Common.Model.Jdeps.dll" />
      <ComponentRef Id="Dsmviz.Common.Util.Jdeps.dll" />
    </Feature>

    <Feature Id="UmlAnalyzerFeature" Title="DSM Suite UML Analyzer" Level="1">
      <ComponentRef Id="Dsmviz.Analyzer.Uml.exe" />
      <ComponentRef Id="Dsmviz.Analyzer.Model.Uml.dll" />
      <ComponentRef Id="Dsmviz.Common.Model.Uml.dll" />
      <ComponentRef Id="Dsmviz.Common.Util.Uml.dll" />
    </Feature>

    <Feature Id="CompareFeature" Title="DSM Suite Compare Tool" Level="1">
      <ComponentRef Id="Dsmviz.Analyzer.Compare.exe" />
      <ComponentRef Id="Dsmviz.Analyzer.CompareLib.dll" />
      <ComponentRef Id="Dsmviz.Analyzer.Model.Compare.dll" />
      <ComponentRef Id="Dsmviz.Common.Model.Compare.dll" />
      <ComponentRef Id="Dsmviz.Common.Util.Compare.dll" />
    </Feature>

    <Feature Id="DsmViewerFeature" Title="DSM Suite Viewer" Level="1">
      <ComponentRef Id="Dsmviz.DsmViewer.View.exe" />
      <ComponentRef Id="Dsmviz.DsmViewer.ViewModel.dll" />
      <ComponentRef Id="Dsmviz.DsmViewer.Application.dll" />
      <ComponentRef Id="Dsmviz.DsmViewer.Model.dll" />
      <ComponentRef Id="Dsmviz.Common.Model.DsmViewer.dll" />
      <ComponentRef Id="Dsmviz.Common.Util.DsmViewer.dll" />
      <ComponentRef Id="Dsmviz.Analyzer.Model.DsmViewer.dll" />
      <ComponentRef Id="ApplicationShortcut" />
    </Feature>
  </Product>
</Wix>
